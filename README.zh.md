# MicroSD-Pico

ç°ä»£C++17 Raspberry Pi Pico MicroSDå¡åº“ï¼Œå…·æœ‰ç±»å‹å®‰å…¨é”™è¯¯å¤„ç†ã€RAIIèµ„æºç®¡ç†å’Œå®Œæ•´æ–‡ä»¶æ“ä½œåŠŸèƒ½ã€‚

## âœ¨ ç‰¹æ€§

- **ç°ä»£C++17** - ä½¿ç”¨RAIIã€æ™ºèƒ½æŒ‡é’ˆã€ç§»åŠ¨è¯­ä¹‰å’Œç»“æ„åŒ–ç»‘å®š
- **ç±»å‹å®‰å…¨é”™è¯¯å¤„ç†** - è‡ªå®šä¹‰Result<T>æ¨¡æ¿å’Œå®Œæ•´é”™è¯¯ç 
- **å®Œæ•´æ–‡ä»¶æ“ä½œ** - è¯»å–ã€å†™å…¥ã€åˆ›å»ºã€åˆ é™¤ã€ç›®å½•ç®¡ç†
- **æµå¼æ“ä½œ** - é€è¡Œæ–‡ä»¶å¤„ç†ï¼Œé€‚åˆå¤§æ–‡ä»¶
- **æ‰¹é‡æ“ä½œ** - é«˜æ•ˆçš„å¤šæ–‡ä»¶å¤„ç†
- **æ–‡ä»¶ç³»ç»Ÿç›‘æ§** - å®¹é‡è¿½è¸ªå’Œå®Œæ•´æ€§æ£€æŸ¥
- **USBä¸²å£è°ƒè¯•** - 115200æ³¢ç‰¹ç‡å®æ—¶çŠ¶æ€è¾“å‡º
- **å‹å¥½çš„ç”¨æˆ·ä½“éªŒ** - å¯è§†åŒ–å€’è®¡æ—¶ï¼Œæå‡ç”¨æˆ·ä½“éªŒ

## ğŸ”§ ç¡¬ä»¶è¦æ±‚

### ç»„ä»¶æ¸…å•
- Raspberry Pi Pico (æˆ–Pico W)
- MicroSDå¡æ¨¡å— (SPIæ¥å£)
- MicroSDå¡ (å»ºè®®FAT32æ ¼å¼)
- æœé‚¦çº¿

### æ¥çº¿å›¾
```
MicroSDæ¨¡å—      Raspberry Pi Pico
-----------     -----------------
VCC         ->  3.3V (Pin 36)
GND         ->  GND  (Pin 38)  
MISO        ->  GPIO11 (Pin 15)
MOSI        ->  GPIO12 (Pin 16)
SCK         ->  GPIO10 (Pin 14)
CS          ->  GPIO13 (Pin 17)
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚
- **Pico SDK v1.5.1** åŒ…å«ARM GNUå·¥å…·é“¾
- **CMake 3.13+**
- **Ninjaæ„å»ºç³»ç»Ÿ**
- **Git** ç”¨äºå…‹éš†

### å®‰è£…æ­¥éª¤

1. **å…‹éš†ä»“åº“:**
```bash
git clone https://github.com/your-repo/MicroSD-Pico.git
cd MicroSD-Pico
```

2. **æ„å»ºé¡¹ç›®:**
```bash
# Windowsç³»ç»Ÿ
.\build_pico.bat

# æ„å»ºè„šæœ¬ä¼šè‡ªåŠ¨:
# - é…ç½®ç¯å¢ƒå˜é‡
# - è®¾ç½®ARMå·¥å…·é“¾è·¯å¾„
# - ä½¿ç”¨CMake + Ninjaç¼–è¯‘
# - è‡ªåŠ¨ç”ŸæˆUF2æ–‡ä»¶
```

3. **çƒ§å½•åˆ°Pico:**
- æŒ‰ä½Picoçš„BOOTSELæŒ‰é’®
- é€šè¿‡USBè¿æ¥ (åº”è¯¥å‡ºç°RPI-RP2ç£ç›˜)
- å°†`build`ç›®å½•ä¸­çš„ä»»æ„`.uf2`æ–‡ä»¶æ‹–å…¥
- æ¾å¼€BOOTSELï¼Œç¨‹åºå°†å¼€å§‹è¿è¡Œ

## ğŸ“ ç”Ÿæˆçš„ç¨‹åº

æ„å»ºå®Œæˆåï¼Œæ‚¨ä¼šåœ¨`build`ç›®å½•ä¸­æ‰¾åˆ°è¿™äº›UF2æ–‡ä»¶:

### ğŸ§ª `serial_test.uf2`
**ç”¨é€”:** æµ‹è¯•ä¸²å£é€šä¿¡ï¼Œä¸ä¾èµ–SDå¡
```
åŠŸèƒ½:
- å€’è®¡æ—¶æ˜¾ç¤º
- æ¯5ç§’å¿ƒè·³æ¶ˆæ¯
- LEDé—ªçƒæŒ‡ç¤º
- ç³»ç»ŸçŠ¶æ€ä¿¡æ¯
```

### ğŸ“š `basic_example.uf2`
**ç”¨é€”:** æ¼”ç¤ºæ ¸å¿ƒMicroSDåŠŸèƒ½
```
åŠŸèƒ½:
- SDå¡åˆå§‹åŒ–å’Œæ£€æµ‹
- æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯æ˜¾ç¤º
- åŸºæœ¬æ–‡ä»¶è¯»å†™æ“ä½œ
- ç›®å½•åˆ›å»ºå’Œåˆ—è¡¨
- é”™è¯¯å¤„ç†æ¼”ç¤º
```

### ğŸ”§ `advanced_example.uf2`
**ç”¨é€”:** å±•ç¤ºé«˜çº§åŠŸèƒ½
```
åŠŸèƒ½:
- æ‰¹é‡æ–‡ä»¶æ“ä½œ
- å¤§æ–‡ä»¶åˆ†å—å¤„ç†
- æ–‡ä»¶ç³»ç»Ÿç›‘æ§
- æ ¡éªŒå’Œå®Œæ•´æ€§æ£€æŸ¥
- é€’å½’ç›®å½•æ“ä½œ
```

### ğŸ› `debug_example.uf2`
**ç”¨é€”:** ç®€å•è°ƒè¯•å’Œæ•…éšœæ’é™¤
```
åŠŸèƒ½:
- é€æ­¥æ“ä½œæ—¥å¿—
- è¯¦ç»†é”™è¯¯æ¶ˆæ¯
- ç¡¬ä»¶è¿æ¥éªŒè¯
- å®æ—¶çŠ¶æ€æ›´æ–°
```

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

```cpp
#include "micro_sd.hpp"
using namespace MicroSD;

int main() {
    stdio_init_all();
    
    // ä½¿ç”¨é»˜è®¤å¼•è„šåˆ›å»ºSDå¡å®ä¾‹
    SPIConfig config; // é»˜è®¤ä½¿ç”¨GPIO10-13
    SDCard sd_card(config);
    
    // åˆå§‹åŒ–SDå¡
    auto init_result = sd_card.initialize();
    if (init_result.is_error()) {
        printf("SDå¡åˆå§‹åŒ–å¤±è´¥\n");
        return -1;
    }
    
    // å†™å…¥æ–‡ä»¶
    std::string content = "ä½ å¥½, MicroSD!";
    auto write_result = sd_card.write_text_file("/hello.txt", content);
    if (write_result.is_ok()) {
        printf("æ–‡ä»¶å†™å…¥æˆåŠŸ\n");
    }
    
    // è¯»å–æ–‡ä»¶
    auto read_result = sd_card.read_file("/hello.txt");
    if (read_result.is_ok()) {
        std::string file_content(read_result->begin(), read_result->end());
        printf("æ–‡ä»¶å†…å®¹: %s\n", file_content.c_str());
    }
    
    return 0;
}
```

## ğŸ” è°ƒè¯•æŒ‡å—

### ä¸²å£ç›‘è§†å™¨è®¾ç½®
1. **è¿æ¥USB** çƒ§å½•ç¨‹åºå
2. **æ‰“å¼€ä¸²å£ç›‘è§†å™¨** (PuTTYã€Arduino IDEã€VS Codeç­‰)
3. **è®¾ç½®æ³¢ç‰¹ç‡** ä¸º `115200`
4. **è§‚å¯Ÿå€’è®¡æ—¶** - ç¨‹åºæ˜¾ç¤º3-5ç§’å¯åŠ¨å€’è®¡æ—¶

### å¸¸è§é—®é¢˜

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| æ²¡æœ‰ä¸²å£è¾“å‡º | æ£€æŸ¥USBè¿æ¥å’Œæ³¢ç‰¹ç‡(115200) |
| SDå¡æœªæ£€æµ‹åˆ° | éªŒè¯æ¥çº¿å¹¶ç¡®ä¿FAT32æ ¼å¼ |
| æ„å»ºå¤±è´¥ | å®‰è£…å®Œæ•´çš„Pico SDKå’ŒARMå·¥å…·é“¾ |
| æƒé™æ‹’ç» | ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œæˆ–æ£€æŸ¥æ–‡ä»¶æƒé™ |

## ğŸ“– APIå‚è€ƒ

### æ ¸å¿ƒç±»

#### `SDCard`
SDå¡æ“ä½œçš„ä¸»è¦æ¥å£
```cpp
// æ„é€ å‡½æ•°
SDCard(const SPIConfig& config = SPIConfig{});

// æ ¸å¿ƒæ“ä½œ
Result<void> initialize();
Result<std::vector<uint8_t>> read_file(const std::string& path);
Result<void> write_text_file(const std::string& path, const std::string& content, bool append = false);
Result<std::vector<FileInfo>> list_directory(const std::string& path);
Result<void> create_directory(const std::string& path);
Result<void> delete_file(const std::string& path);
```

#### `Result<T>`
ç±»å‹å®‰å…¨é”™è¯¯å¤„ç†
```cpp
// æ£€æŸ¥ç»“æœ
if (result.is_ok()) {
    auto value = *result; // è·å–å€¼
} else {
    auto error = result.error_code();
    auto message = result.error_message();
}
```

### é…ç½®

#### `SPIConfig`
ç¡¬ä»¶å¼•è„šé…ç½®
```cpp
struct SPIConfig {
    uint8_t pin_sck = 10;   // æ—¶é’Ÿä¿¡å·
    uint8_t pin_mosi = 12;  // ä¸»æœºè¾“å‡ºä»æœºè¾“å…¥
    uint8_t pin_miso = 11;  // ä¸»æœºè¾“å…¥ä»æœºè¾“å‡º
    uint8_t pin_cs = 13;    // ç‰‡é€‰ä¿¡å·
    uint32_t baudrate = 12500000; // 12.5 MHz
};
```

## ğŸ› ï¸ æ„å»ºç³»ç»Ÿ

é¡¹ç›®ä½¿ç”¨ç°ä»£çš„CMake + Ninjaæ„å»ºç³»ç»Ÿ:

### ç¯å¢ƒè®¾ç½®
- **PICO_SDK_PATH**: æŒ‡å‘Pico SDKå®‰è£…ç›®å½•
- **ARM_TOOLCHAIN_PATH**: ARM GNUå·¥å…·é“¾äºŒè¿›åˆ¶æ–‡ä»¶
- **CMAKE_PATH**: CMakeå¯æ‰§è¡Œæ–‡ä»¶ä½ç½®
- **NINJA_PATH**: Ninjaæ„å»ºç³»ç»Ÿ

### æ„å»ºé…ç½®
- **C++æ ‡å‡†**: C++17
- **æ„å»ºç±»å‹**: Release (ä¼˜åŒ–ç‰ˆæœ¬)
- **ç›®æ ‡æ¶æ„**: ARM Cortex-M0+
- **ä¸²å£è¾“å‡º**: USB CDC (115200æ³¢ç‰¹ç‡)

## ğŸ“Š ç¨‹åºè¿è¡Œæ•ˆæœ

### å¯åŠ¨åºåˆ—
```
ç¨‹åºå¯åŠ¨ä¸­ï¼Œç­‰å¾…ä¸²å£è¿æ¥...
å¯åŠ¨å€’è®¡æ—¶: 5 ç§’
å¯åŠ¨å€’è®¡æ—¶: 4 ç§’
å¯åŠ¨å€’è®¡æ—¶: 3 ç§’
å¯åŠ¨å€’è®¡æ—¶: 2 ç§’
å¯åŠ¨å€’è®¡æ—¶: 1 ç§’
å¯åŠ¨å®Œæˆ!

========================================
       MicroSDåº“ä½¿ç”¨ç¤ºä¾‹
========================================
ç¨‹åºå·²å¯åŠ¨ï¼
ç¼–è¯‘æ—¶é—´: Jun 10 2025 13:47:37
========================================
```

### è¿è¡Œç¤ºä¾‹è¾“å‡º
```
æ­£åœ¨åˆå§‹åŒ–SDå¡...
SDå¡åˆå§‹åŒ–æˆåŠŸ!
æ–‡ä»¶ç³»ç»Ÿç±»å‹: FAT32
æ€»å®¹é‡: 3466.00 MB
å¯ç”¨å®¹é‡: 3465.97 MB

=== æ ¹ç›®å½•å†…å®¹ ===
[DIR] System Volume Information (0 bytes)
[DIR] test_dir (0 bytes)
[FILE] stream_test.txt (161 bytes)

=== åˆ›å»ºæµ‹è¯•ç›®å½• ===
ç›®å½• '/test_dir' å·²å­˜åœ¨ï¼Œè·³è¿‡åˆ›å»º

=== å†™å…¥æµ‹è¯•æ–‡ä»¶ ===
å†™å…¥æ–‡ä»¶ '/test_dir/hello.txt' æˆåŠŸ
```

## ğŸ¤ è´¡çŒ®

1. Fork è¿™ä¸ªä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature-name`)
3. æäº¤æ‚¨çš„æ›´æ”¹ (`git commit -am 'Add feature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature-name`)
5. åˆ›å»ºPull Request

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®åŸºäºMITè®¸å¯è¯ - æŸ¥çœ‹ [LICENSE](LICENSE) æ–‡ä»¶äº†è§£è¯¦æƒ…ã€‚

## ğŸ™ è‡´è°¢

- **Raspberry PiåŸºé‡‘ä¼š** æä¾›ä¼˜ç§€çš„Pico SDK
- **pico_fatfs** åº“æä¾›FATæ–‡ä»¶ç³»ç»Ÿæ”¯æŒ
- **FatFs** by ChaN æä¾›åº•å±‚æ–‡ä»¶ç³»ç»Ÿå®ç°

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- **é—®é¢˜æŠ¥å‘Š**: é€šè¿‡GitHub IssuesæŠ¥å‘Šbugå’Œè¯·æ±‚åŠŸèƒ½
- **æ–‡æ¡£**: `/examples`ç›®å½•åŒ…å«å®Œæ•´ç¤ºä¾‹
- **ç¡¬ä»¶**: è¯·ç¡®è®¤è¿æ¥ç¬¦åˆä¸Šè¿°æ¥çº¿å›¾

---

*ç”¨ â¤ï¸ ä¸ºRaspberry Pi Picoç¤¾åŒºæ„å»º* 