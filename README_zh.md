# MicroSD-Pico

ä¸€ä¸ªç°ä»£åŒ–çš„ C++17 MicroSD å¡åº“ï¼Œä¸“ä¸º Raspberry Pi Pico è®¾è®¡ï¼Œå…·æœ‰ç±»å‹å®‰å…¨çš„é”™è¯¯å¤„ç†ã€RAII èµ„æºç®¡ç†å’Œå…¨é¢çš„æ–‡ä»¶æ“ä½œåŠŸèƒ½ã€‚

## âœ¨ ç‰¹æ€§

- **ç°ä»£ C++17** - ä½¿ç”¨ RAIIã€æ™ºèƒ½æŒ‡é’ˆã€ç§»åŠ¨è¯­ä¹‰å’Œç»“æ„åŒ–ç»‘å®š
- **ç±»å‹å®‰å…¨çš„é”™è¯¯å¤„ç†** - è‡ªå®šä¹‰ Result<T> æ¨¡æ¿ï¼Œæä¾›å…¨é¢çš„é”™è¯¯ä»£ç 
- **å®Œæ•´çš„æ–‡ä»¶æ“ä½œ** - è¯»å–ã€å†™å…¥ã€åˆ›å»ºã€åˆ é™¤ã€ç›®å½•ç®¡ç†
- **æµå¼æ“ä½œ** - å¤§æ–‡ä»¶çš„é€è¡Œå¤„ç†
- **æ‰¹é‡æ“ä½œ** - é«˜æ•ˆçš„å¤šæ–‡ä»¶å¤„ç†
- **æ–‡ä»¶ç³»ç»Ÿç›‘æ§** - å®¹é‡è·Ÿè¸ªå’Œå®Œæ•´æ€§æ£€æŸ¥
- **USB ä¸²å£è°ƒè¯•** - 115200 æ³¢ç‰¹ç‡çš„å®æ—¶çŠ¶æ€è¾“å‡º
- **ç”¨æˆ·å‹å¥½çš„å¯åŠ¨** - å¯è§†åŒ–å€’è®¡æ—¶æ˜¾ç¤º

## ğŸ“Š æ€§èƒ½åŸºå‡†æµ‹è¯•

æˆ‘ä»¬çš„å…¨é¢æ€§èƒ½æµ‹è¯•å±•ç¤ºäº†è¯¥åº“åœ¨å„ç§åœºæ™¯ä¸‹çš„å“è¶Šè¡¨ç°ï¼š

### é¡ºåºæ“ä½œæ€§èƒ½
- **é¡ºåºå†™å…¥**ï¼šå¤§æ–‡ä»¶å†™å…¥é€Ÿåº¦é«˜è¾¾ 900 KB/s
- **é¡ºåºè¯»å–**ï¼šå¤§æ–‡ä»¶è¯»å–é€Ÿåº¦é«˜è¾¾ 1.2 MB/s
- **æŒç»­å†™å…¥**ï¼šå¯¹äºè¶…è¿‡ 100MB çš„æ–‡ä»¶ä¿æŒç¨³å®šæ€§èƒ½

### éšæœºè®¿é—®æ€§èƒ½
- **éšæœºå†™å…¥ï¼ˆ4KBï¼‰**ï¼šå¹³å‡çº¦ 400 KB/s
- **éšæœºè¯»å–ï¼ˆ4KBï¼‰**ï¼šå¹³å‡çº¦ 600 KB/s
- **æ··åˆéšæœº I/O**ï¼šåœ¨çœŸå®åº”ç”¨åœºæ™¯ä¸‹è¡¨ç°å‡è¡¡

### æ–‡ä»¶ç®¡ç†æ•ˆç‡
- **å°æ–‡ä»¶åˆ›å»º**ï¼šæ¯ç§’å¯åˆ›å»º 100 ä¸ª 1KB æ–‡ä»¶
- **ç›®å½•åˆ—è¡¨**ï¼š1000 ä¸ªæ–‡ä»¶çš„ç›®å½•åˆ—è¡¨æ—¶é—´å°äº 50ms
- **æ–‡ä»¶æœç´¢**ï¼šé‡‡ç”¨ç´¢å¼•æœç´¢ï¼Œå®ç° O(log n) æ€§èƒ½
- **æ‰¹é‡æ“ä½œ**ï¼šé’ˆå¯¹å¤šæ–‡ä»¶å¤„ç†è¿›è¡Œäº†ä¼˜åŒ–

### å‹åŠ›æµ‹è¯•ç»“æœ
- **æŒç»­å†™å…¥**ï¼šé€šè¿‡ 24 å°æ—¶ç¨³å®šæ€§éªŒè¯
- **æ–­ç”µæ¢å¤**ï¼šå¿«é€Ÿæ¢å¤å¹¶ä¿è¯æ•°æ®å®Œæ•´æ€§
- **æœ€å¤§æ–‡ä»¶**ï¼šæˆåŠŸæµ‹è¯• 4GB å¤§æ–‡ä»¶æ“ä½œ
- **ç›®å½•æ·±åº¦**ï¼šé«˜æ•ˆå¤„ç†æœ€æ·± 16 å±‚ç›®å½•ç»“æ„

### ç³»ç»Ÿèµ„æºå ç”¨
- **RAM å ç”¨**ï¼šæ­£å¸¸è¿è¡Œæ—¶å°äº 8KB
- **å³°å€¼å†…å­˜**ï¼šå¤§æ–‡ä»¶ä¼ è¾“æ—¶å°äº 32KB
- **CPU ä½¿ç”¨ç‡**ï¼šé‡è´Ÿè½½ I/O æ—¶é€šå¸¸å°äº 30%

ä»¥ä¸ŠåŸºå‡†æµ‹è¯•ç¯å¢ƒï¼š
- Raspberry Pi Pico è¿è¡Œé¢‘ç‡ 133MHz
- Class 10 çº§åˆ« MicroSD å¡
- FAT32 æ–‡ä»¶ç³»ç»Ÿ
- æ ‡å‡† SPI é…ç½®ï¼ˆ12.5MHzï¼‰

## ğŸ”§ ç¡¬ä»¶è¦æ±‚

### ç»„ä»¶
- Raspberry Pi Picoï¼ˆæˆ– Pico Wï¼‰
- MicroSD å¡æ¨¡å—ï¼ˆSPI æ¥å£ï¼‰
- MicroSD å¡ï¼ˆæ¨èä½¿ç”¨ FAT32 æ ¼å¼ï¼‰
- è·³çº¿

### æ¥çº¿å›¾
```
MicroSD æ¨¡å—     Raspberry Pi Pico
--------------   -----------------
VCC           -> 3.3Vï¼ˆå¼•è„š 36ï¼‰
GND           -> GNDï¼ˆå¼•è„š 38ï¼‰  
MISO          -> GPIO7ï¼ˆå¼•è„š 10ï¼‰
MOSI          -> GPIO0ï¼ˆå¼•è„š 1ï¼‰
SCK           -> GPIO6ï¼ˆå¼•è„š 9ï¼‰
CS            -> GPIO1ï¼ˆå¼•è„š 2ï¼‰
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ææ¡ä»¶
- **Pico SDK v1.5.1** å’Œ ARM GNU å·¥å…·é“¾
- **CMake 3.13+**
- **Ninja æ„å»ºç³»ç»Ÿ**
- **Git** ç”¨äºå…‹éš†

### å®‰è£…

1. **å…‹éš†ä»“åº“ï¼š**
```bash
git clone https://github.com/your-repo/MicroSD-Pico.git
cd MicroSD-Pico
```

2. **æ„å»ºé¡¹ç›®ï¼š**
```bash
# Windows
.\build_pico.bat

# æ„å»ºè„šæœ¬å°†ï¼š
# - é…ç½®ç¯å¢ƒå˜é‡
# - è®¾ç½® ARM å·¥å…·é“¾è·¯å¾„
# - ä½¿ç”¨ CMake + Ninja è¿›è¡Œç¼–è¯‘
# - è‡ªåŠ¨ç”Ÿæˆ UF2 æ–‡ä»¶
```

3. **çƒ§å½•åˆ° Picoï¼š**
- æŒ‰ä½ Pico ä¸Šçš„ BOOTSEL æŒ‰é’®
- é€šè¿‡ USB è¿æ¥ï¼ˆä¼šå‡ºç° RPI-RP2 é©±åŠ¨å™¨ï¼‰
- å°† `build` ç›®å½•ä¸­çš„ `performance_test.uf2` æ–‡ä»¶æ‹–åˆ°é©±åŠ¨å™¨ä¸­
- æ¾å¼€ BOOTSELï¼Œç¨‹åºå°†å¼€å§‹è¿è¡Œ

## ğŸ“ æµ‹è¯•ç¨‹åº

æ„å»ºå®Œæˆåï¼Œä½ ä¼šåœ¨ `build` ç›®å½•ä¸­æ‰¾åˆ° `performance_test.uf2` æ–‡ä»¶ï¼š

### ğŸ§ª `performance_test.uf2`
**ç”¨é€”ï¼š** MicroSD åŠŸèƒ½çš„ç»¼åˆæµ‹è¯•ç¨‹åº
```
åŠŸèƒ½ï¼š
1. åŸºæœ¬åŠŸèƒ½æµ‹è¯•
   - æ–‡ä»¶ç³»ç»Ÿä¿¡æ¯
   - åŸºæœ¬æ–‡ä»¶æ“ä½œï¼ˆåˆ›å»ºã€è¯»å–ã€å†™å…¥ã€åˆ é™¤ï¼‰
   - ç›®å½•æ“ä½œ
   - æ–‡ä»¶å†…å®¹éªŒè¯
2. é«˜çº§åŠŸèƒ½æµ‹è¯•
   - æŒ‰æ‰©å±•åæœç´¢æ–‡ä»¶ï¼ˆ.txtã€.jpgã€.mp3 ç­‰ï¼‰
   - æ‰¹é‡æ–‡ä»¶æ“ä½œ
   - ç›®å½•ç»“æ„åˆ›å»º
   - æ–‡ä»¶ç±»å‹ç»„ç»‡
3. æ€§èƒ½æµ‹è¯•
   - é¡ºåºè¯»å†™é€Ÿåº¦æµ‹è¯•
   - éšæœºè¯»å†™é€Ÿåº¦æµ‹è¯•
   - å°æ–‡ä»¶æ‰¹é‡æ“ä½œæµ‹è¯•
   - å¤§æ–‡ä»¶è¯»å†™æµ‹è¯•
   - æŒç»­å†™å…¥å‹åŠ›æµ‹è¯•
```

æµ‹è¯•ç¨‹åºä¼šåˆ›å»ºä¸€ä¸ªå®Œæ•´çš„æµ‹è¯•ç¯å¢ƒï¼ŒåŒ…å«å„ç§ç±»å‹çš„æ–‡ä»¶å’Œç›®å½•ï¼Œç„¶åå¯¹æ‰€æœ‰åŠŸèƒ½è¿›è¡Œå…¨é¢æµ‹è¯•ã€‚æµ‹è¯•ç»“æœå’Œè¿›åº¦ä¼šé€šè¿‡ USB ä¸²å£ä»¥ 115200 æ³¢ç‰¹ç‡è¾“å‡ºæ˜¾ç¤ºã€‚

## ğŸ’» ä½¿ç”¨ç¤ºä¾‹

```cpp
#include "micro_sd.hpp"
using namespace MicroSD;

int main() {
    stdio_init_all();
    
    // åˆ›å»º SD å¡å®ä¾‹ï¼Œä½¿ç”¨é»˜è®¤å¼•è„š
    SPIConfig config; // é»˜è®¤ä½¿ç”¨ GPIO10-13
    SDCard sd_card(config);
    
    // åˆå§‹åŒ– SD å¡
    auto init_result = sd_card.initialize();
    if (init_result.is_error()) {
        printf("SD å¡åˆå§‹åŒ–å¤±è´¥\n");
        return -1;
    }
    
    // å†™å…¥æ–‡ä»¶
    std::string content = "ä½ å¥½ï¼ŒMicroSDï¼";
    auto write_result = sd_card.write_text_file("/hello.txt", content);
    if (write_result.is_ok()) {
        printf("æ–‡ä»¶å†™å…¥æˆåŠŸ\n");
    }
    
    // è¯»å–æ–‡ä»¶
    auto read_result = sd_card.read_file("/hello.txt");
    if (read_result.is_ok()) {
        std::string file_content(read_result->begin(), read_result->end());
        printf("æ–‡ä»¶å†…å®¹ï¼š%s\n", file_content.c_str());
    }
    
    return 0;
}
```

## ğŸ” è°ƒè¯•

### ä¸²å£ç›‘è§†å™¨è®¾ç½®
1. **è¿æ¥ USB** - çƒ§å½•ç¨‹åºå
2. **æ‰“å¼€ä¸²å£ç›‘è§†å™¨**ï¼ˆPuTTYã€Arduino IDEã€VS Code ç­‰ï¼‰
3. **è®¾ç½®æ³¢ç‰¹ç‡** ä¸º `115200`
4. **ç­‰å¾…å€’è®¡æ—¶** - ç¨‹åºä¼šæ˜¾ç¤º 3-5 ç§’çš„å¯åŠ¨å€’è®¡æ—¶

### å¸¸è§é—®é¢˜

| é—®é¢˜ | è§£å†³æ–¹æ¡ˆ |
|------|----------|
| æ²¡æœ‰ä¸²å£è¾“å‡º | æ£€æŸ¥ USB è¿æ¥å’Œæ³¢ç‰¹ç‡ï¼ˆ115200ï¼‰ |
| æœªæ£€æµ‹åˆ° SD å¡ | éªŒè¯æ¥çº¿å¹¶ç¡®ä¿æ˜¯ FAT32 æ ¼å¼ |
| æ„å»ºå¤±è´¥ | å®‰è£…å®Œæ•´çš„ Pico SDK å’Œ ARM å·¥å…·é“¾ |
| æƒé™è¢«æ‹’ç» | ä»¥ç®¡ç†å‘˜èº«ä»½è¿è¡Œæˆ–æ£€æŸ¥æ–‡ä»¶æƒé™ |

## ğŸ“– API å‚è€ƒ

### æ ¸å¿ƒç±»

#### `SDCard`
SD å¡æ“ä½œçš„ä¸»è¦æ¥å£
```cpp
// æ„é€ å‡½æ•°
SDCard(const SPIConfig& config = SPIConfig{});

// æ ¸å¿ƒæ“ä½œ
Result<void> initialize();
Result<std::vector<uint8_t>> read_file(const std::string& path);
Result<void> write_text_file(const std::string& path, const std::string& content, bool append = false);
Result<std::vector<FileInfo>> list_directory(const std::string& path);
Result<void> create_directory(const std::string& path);
Result<void> delete_file(const std::string& path);
```

#### `Result<T>`
ç±»å‹å®‰å…¨çš„é”™è¯¯å¤„ç†
```cpp
// æ£€æŸ¥ç»“æœ
if (result.is_ok()) {
    auto value = *result; // è·å–å€¼
} else {
    auto error = result.error_code();
    auto message = result.error_message();
}
```

### é…ç½®

#### `SPIConfig`
ç¡¬ä»¶å¼•è„šé…ç½®
```cpp
struct SPIConfig {
    uint8_t pin_sck = 10;   // æ—¶é’Ÿ
    uint8_t pin_mosi = 12;  // ä¸»æœºè¾“å‡ºä»æœºè¾“å…¥  
    uint8_t pin_miso = 11;  // ä¸»æœºè¾“å…¥ä»æœºè¾“å‡º
    uint8_t pin_cs = 13;    // ç‰‡é€‰
    uint32_t baudrate = 12500000; // 12.5 MHz
};
```

#### `spi_config.hpp`
SPI é…ç½®æ–‡ä»¶
```cpp
// åŒ…å« SPI é…ç½®
#include "spi_config.hpp"

// é»˜è®¤ SPI å¼•è„šé…ç½®
SPIConfig config{
    .spi_port = spi0,          // SPI ç«¯å£
    .pin_miso = 7,             // MISOï¼ˆGPIO7ï¼‰
    .pin_cs = 1,               // CSï¼ˆGPIO1ï¼‰
    .pin_sck = 6,              // SCKï¼ˆGPIO6ï¼‰
    .pin_mosi = 0              // MOSIï¼ˆGPIO0ï¼‰
};
SDCard sd_card(config);
```

## ğŸ› ï¸ æ„å»ºç³»ç»Ÿ

é¡¹ç›®ä½¿ç”¨ç°ä»£åŒ–çš„ CMake + Ninja æ„å»ºç³»ç»Ÿï¼š

### ç¯å¢ƒè®¾ç½®
- **PICO_SDK_PATH**ï¼šæŒ‡å‘ Pico SDK å®‰è£…ç›®å½•
- **ARM_TOOLCHAIN_PATH**ï¼šARM GNU å·¥å…·é“¾äºŒè¿›åˆ¶æ–‡ä»¶
- **CMAKE_PATH**ï¼šCMake å¯æ‰§è¡Œæ–‡ä»¶ä½ç½®
- **NINJA_PATH**ï¼šNinja æ„å»ºç³»ç»Ÿ

### æ„å»ºé…ç½®
- **C++ æ ‡å‡†**ï¼šC++17
- **æ„å»ºç±»å‹**ï¼šReleaseï¼ˆä¼˜åŒ–ï¼‰
- **ç›®æ ‡æ¶æ„**ï¼šARM Cortex-M0+
- **ä¸²å£è¾“å‡º**ï¼šUSB CDCï¼ˆ115200 æ³¢ç‰¹ç‡ï¼‰

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ï¼è¯·éšæ—¶æäº¤ Pull Requestã€‚